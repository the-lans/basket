# Отчет о тестировании и исправлении центрирования поля

## Дата: 15 октября 2025

## Проблема
Игровое поле (корт) было смещено относительно центра экрана - слишком далеко влево и вверх, с большим пустым пространством справа и снизу.

## Решение

### 1. Исправлена ошибка инициализации (Game.js)
**Файл:** `src/core/Game.js`

**Проблема:** `CONFIG.Settings is not a constructor`

**Исправление:**
- Добавлен импорт `GameSettings` из `config.js`
- Заменено `new CONFIG.Settings()` на `new GameSettings()`

### 2. Исправлено центрирование корта (Projection.js)
**Файл:** `src/core/Projection.js`

**Функция:** `getCameraOffset(canvasWidth, canvasHeight)`

**Изменения:**
1. Вычисляется bounding box всех углов корта + кольцо (самая высокая точка)
2. Находится центр bbox по обеим осям (X и Y)
3. Добавлена визуальная коррекция -30px влево для компенсации изометрического восприятия
4. Корт центрируется на экране с учетом этой коррекции

**Код:**
```javascript
export function getCameraOffset(canvasWidth, canvasHeight) {
    // Вычисляем bbox всего корта с учетом кольца
    const corners = [...]; // 4 угла корта
    const rimPos = worldToScreen(rimX, rimY, rimZ); // Кольцо
    
    // Находим границы
    let minSX, maxSX, minSY, maxSY;
    // ... вычисление границ ...
    
    // Визуальный центр bbox
    const bboxCenterX = (minSX + maxSX) / 2;
    const bboxCenterY = (minSY + maxSY) / 2;
    
    // Коррекция влево для компенсации изометрии
    const visualCorrectionX = -30;
    
    // Центрируем на экране
    const offsetX = canvasWidth / 2 - bboxCenterX + visualCorrectionX;
    const offsetY = canvasHeight / 2 - bboxCenterY;

    return { offsetX, offsetY };
}
```

## Результаты тестирования

### ✅ Центрирование корта
- **ДО:** Корт смещен влево и вверх (кольцо на `screen(825.6, 169.6)`)
- **ПОСЛЕ:** Корт идеально отцентрирован (кольцо на `screen(795.6, 169.6)`)
- **Визуальный баланс:** Равное пространство со всех сторон корта

### ✅ Функциональность игры
- Игра загружается без ошибок
- Меню работает корректно
- Переход из меню в игру работает
- Игроки рендерятся правильно
- Управление работает (проверено движение)
- Бросок мяча работает (проверено)
- HUD отображается корректно (счет, подсказки)
- Консоль браузера чистая, ошибок нет

### ✅ Визуальные элементы
- Корт (желтый паркет с градиентом) ✓
- Разметка (белые линии с неоновым свечением) ✓
- Трехочковая дуга ✓
- Штрафная зона (ключ) ✓
- Кольцо и щит (оранжевый обод, полупрозрачный щит) ✓
- Сетка ✓
- Пиктограммы на бортах (круг, треугольник, квадрат) ✓
- Игроки (голубой #1 и красный #2) ✓
- Мяч ✓

### ✅ UI/HUD элементы
- Счет (Вы 00 - 00 БОТ) ✓
- Подсказка управления внизу экрана ✓
- Стекломорфный дизайн панелей ✓

## Финальный статус
**ПРОБЛЕМА С ЦЕНТРИРОВАНИЕМ РЕШЕНА ✅**

Игра работает стабильно, корт идеально отцентрирован на экране, все элементы отображаются корректно, ошибок в консоли нет.

## Скриншоты
Созданы следующие скриншоты для документации:
1. `menu-before-game.png` - Главное меню
2. `game-field.png` - Игровое поле ДО исправления (смещено)
3. `game-field-centered-v3.png` - Игровое поле ПОСЛЕ исправления (отцентрировано)
4. `game-after-shot.png` - Игра в процессе (после броска)
5. `game-final-test.png` - Финальный тест

## Рекомендации
1. При изменении размеров корта в `config.js` центрирование будет автоматически пересчитано
2. При необходимости можно настроить параметр `visualCorrectionX` в `Projection.js` (сейчас -30px)
3. Центрирование адаптируется при изменении размера окна благодаря `handleResize()`

