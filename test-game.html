<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–≥—Ä—ã –ë–∞—Å–∫–µ—Ç</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: sans-serif;
            background: #0E1320;
            color: white;
        }
        
        #results {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .test {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-left: 4px solid #39B8FF;
        }
        
        .test.pass {
            border-left-color: #4CAF50;
        }
        
        .test.fail {
            border-left-color: #FF4D5A;
        }
        
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #39B8FF;
            border-radius: 8px;
        }
        
        button {
            background: #39B8FF;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #2A9FE5;
        }
    </style>
</head>
<body>
    <h1>üèÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–≥—Ä—ã ¬´–ë–∞—Å–∫–µ—Ç¬ª</h1>
    
    <div>
        <button onclick="runTests()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã</button>
        <button onclick="testManual()">üéÆ –û—Ç–∫—Ä—ã—Ç—å –∏–≥—Ä—É –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞</button>
    </div>
    
    <div id="results"></div>
    
    <iframe id="game-frame" style="display:none;"></iframe>
    
    <script>
        const results = document.getElementById('results');
        const frame = document.getElementById('game-frame');
        
        async function runTests() {
            results.innerHTML = '<h2>–ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤...</h2>';
            
            const tests = [];
            
            // –¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
            tests.push({
                name: '–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã',
                run: async () => {
                    frame.style.display = 'block';
                    frame.src = 'index.html';
                    
                    await new Promise(resolve => {
                        frame.onload = resolve;
                        setTimeout(resolve, 3000);
                    });
                    
                    const gameWindow = frame.contentWindow;
                    return !!gameWindow.game;
                }
            });
            
            // –¢–µ—Å—Ç 2: –ü–µ—Ä–µ—Ö–æ–¥ –≤ –∏–≥—Ä—É
            tests.push({
                name: '–ü–µ—Ä–µ—Ö–æ–¥ –∏–∑ –º–µ–Ω—é –≤ –∏–≥—Ä—É',
                run: async () => {
                    const gameWindow = frame.contentWindow;
                    const btn = gameWindow.document.getElementById('btn-play');
                    
                    if (!btn) return false;
                    
                    btn.click();
                    await new Promise(r => setTimeout(r, 1000));
                    
                    const scene = gameWindow.game?.sceneManager?.currentScene?.name;
                    return scene === 'game';
                }
            });
            
            // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
            tests.push({
                name: '–ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞',
                run: async () => {
                    const gameWindow = frame.contentWindow;
                    const scene = gameWindow.game?.sceneManager?.currentScene;
                    
                    return !!(scene && scene.player && scene.ai && scene.ball);
                }
            });
            
            // –¢–µ—Å—Ç 4: –°—á—ë—Ç –∏ UI
            tests.push({
                name: 'UI –∏ —Å—á—ë—Ç —Ä–∞–±–æ—Ç–∞—é—Ç',
                run: async () => {
                    const gameWindow = frame.contentWindow;
                    const scene = gameWindow.game?.sceneManager?.currentScene;
                    
                    return scene.rules.playerScore === 0 && 
                           scene.rules.aiScore === 0 &&
                           scene.hud !== null;
                }
            });
            
            // –¢–µ—Å—Ç 5: –ú—è—á —É –∏–≥—Ä–æ–∫–∞
            tests.push({
                name: '–ú—è—á —É –∏–≥—Ä–æ–∫–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ',
                run: async () => {
                    const gameWindow = frame.contentWindow;
                    const scene = gameWindow.game?.sceneManager?.currentScene;
                    
                    return scene.player.hasBall === true;
                }
            });
            
            // –¢–µ—Å—Ç 6: AI —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–≤–∏–≥–∞–µ—Ç—Å—è
            tests.push({
                name: 'AI –º–æ–∂–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è',
                run: async () => {
                    const gameWindow = frame.contentWindow;
                    const scene = gameWindow.game?.sceneManager?.currentScene;
                    const aiInitial = {x: scene.ai.x, y: scene.ai.y};
                    
                    // –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ
                    for (let i = 0; i < 30; i++) {
                        scene.ai.applyMovement(0, 1);
                        scene.ai.update(0.016);
                    }
                    
                    return scene.ai.x !== aiInitial.x || scene.ai.y !== aiInitial.y;
                }
            });
            
            // –¢–µ—Å—Ç 7: –î—Ä–∏–±–ª–∏–Ω–≥ –º—è—á–∞
            tests.push({
                name: '–ê–Ω–∏–º–∞—Ü–∏—è –¥—Ä–∏–±–ª–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç',
                run: async () => {
                    const gameWindow = frame.contentWindow;
                    const scene = gameWindow.game?.sceneManager?.currentScene;
                    const ball = scene.ball;
                    
                    const z1 = ball.z;
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å –º—è—á –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
                    for (let i = 0; i < 30; i++) {
                        ball.update(0.016);
                    }
                    
                    const z2 = ball.z;
                    
                    // Z –¥–æ–ª–∂–Ω–∞ –º–µ–Ω—è—Ç—å—Å—è –∏–∑-–∑–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
                    return Math.abs(z2 - z1) > 0.01;
                }
            });
            
            // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
            let html = '<h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h2>';
            let passed = 0;
            
            for (const test of tests) {
                try {
                    const result = await test.run();
                    const status = result ? 'pass' : 'fail';
                    const icon = result ? '‚úÖ' : '‚ùå';
                    
                    html += `<div class="test ${status}">${icon} ${test.name}</div>`;
                    if (result) passed++;
                } catch (error) {
                    html += `<div class="test fail">‚ùå ${test.name}: ${error.message}</div>`;
                }
            }
            
            html += `<h3>–ü—Ä–æ–π–¥–µ–Ω–æ: ${passed}/${tests.length}</h3>`;
            results.innerHTML = html;
        }
        
        function testManual() {
            frame.style.display = 'block';
            frame.src = 'index.html';
            results.innerHTML = '<h2>–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å –≤—Ä—É—á–Ω—É—é:</h2>' +
                '<ul>' +
                '<li>‚úÖ –ü–æ–ª–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ, –∫–æ–ª—å—Ü–æ –≤–∏–¥–Ω–æ</li>' +
                '<li>‚úÖ –ù–µ—Ç —Å–∏–Ω–∏—Ö –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤</li>' +
                '<li>‚úÖ –ú—è—á –æ—Ç—Å–∫–∞–∫–∏–≤–∞–µ—Ç –ø—Ä–∏ –¥—Ä–∏–±–ª–∏–Ω–≥–µ</li>' +
                '<li>‚úÖ –ü–æ–ª–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –∫–æ—Ä—Ç–∞</li>' +
                '<li>‚úÖ AI –¥–≤–∏–≥–∞–µ—Ç—Å—è</li>' +
                '</ul>';
        }
    </script>
</body>
</html>

