---
alwaysApply: false
---
Игра «Баскет» — 1v1 Half‑Court, изометрия, ПК

Контекст
Создай HTML5 Canvas 2D игру «Баскет»: 1 игрок против AI, половина корта, изометрическая камера 2.5D. Управление — клавиатура+мышь (K2). Дизайн — современная интерпретация присланного рисунка: желтый корт, красно‑голубые трибуны, геометрические пиктограммы на бортах, неоновая подсветка. Тема светлая. Командные цвета: Красные (AI) vs Голубые (Игрок). Локализация RU. Ориентация — Landscape на ПК.

Правила матча
- Режим: 1v1 Half‑Court. Официальная разметка половины корта.
- Счет до 11 очков, выигрывает первый набравший 11.
- Шот‑клок по умолчанию 24 сек. Настраиваемый (12/24/∞) в настройках.
- Система очков «стрит»: 1 очко за броски внутри дуги, 2 очка из‑за дуги. В настройках опция переключить на «классические 2/3».
- После каждого попадания — «check ball» у дуги (верх ключа). После подбора в защите мяч нужно «очистить» за дугу перед атакой.
- Упрощенные фолы: при агрессивном отборе или контакте по руке на броске — 1 штрафной (1 очко) без подбора, затем «check ball».

Управление (ПК)
- Движение: WASD или стрелки.
- Спринт: Shift (истощает выносливость).
- Бросок: ЛКМ — удерживай для прицеливания/силы, отпусти для броска. Курсор задает угол в плоскости, длительность удержания — силу/высоту.
- Контекст ПКМ:
  - В атаке: ПКМ — финт/step‑back (быстрый откат с коротким неуязвимым окном), если под кольцом — лэйап.
  - В защите: ПКМ — попытка перехвата/стрипа. Имеет кулдаун и риск фола.
- Пауза: Esc.

Ключевая механика
- Изометрическая проекция (псевдо‑3D):
  - Мировые координаты: (x,y) — пол, z — высота (мяч/прыжки).
  - Экран: sx = (x - y) * isoX, sy = (x + y) * isoY - z.
  - Сортировка по слою: сущности рендерить по y, затем по z.
- Игроки (полуреалистичные силуэты R1):
  - Скелет: торс, бедро/голень/стопа (L/R), плечо/предплечье/кисть (L/R), голова. Анимации: idle, run, dribble, cross, step‑back, jump‑shot, layup, block, rebound, react_foul.
  - Анимации на Canvas трансформациях, тени‑эллипсы для «приземления», легкий градиентный шейдинг.
  - Статы архетипов (минимальное разнообразие): Balanced (игрок), Aggressive Defender (бот). Параметры в config.
- Мяч (аркада):
  - Траектория — баллистика: скорость из угла прицела + сила, гравитация g. Минимальный спин только в визуале.
  - Обод — 2D окружность (радиус r_rim), щит — AABB. Упрощенные коллизии и «прощение» точных касаний: небольшое магнитное окно ±ε при верной силе.
  - Сетка визуальная, через клипы и спрайт‑строки.
- Выносливость: шкала уменьшается при спринте/рывках, восстанавливается со временем; влияние на скорость и точность.
- Индикатор силы броска: кольцевая шкала у игрока + подсветка «оптимальной зоны» по дистанции.

AI (Standard)
- Состояния: defend_press, defend_contest, recover, attack_drive, attack_probe, shoot, rebound, check_ball, clear_ball.
- Поведение:
  - В защите держит дистанцию d, пытается перекрывать путь к дуге, контестит бросок при поднятии мяча.
  - В атаке оценивает: если открыто — бросок; иначе — один‑два направления дриблинга, финт, попытка прохода; у дуги — лэйап.
  - Тайм‑менеджмент: следит за шот‑клоком, форсирует бросок <5 сек.
  - Вероятности попадания зависят от дистанции, угла, усталости, контеста игрока, плюс небольшая стохастика.

Дизайн и визуал
- Палитра (CSS переменные):
  - --court-yellow: #F3D24B
  - --tribune-red: #FF4D5A
  - --tribune-blue: #39B8FF
  - --line-white: #FFFFFF
  - --accent-neon: #7CFFEA
  - --ui-bg: rgba(255,255,255,0.65)
  - --text-dark: #0E1320
- Корт: желтый паркет с мягким гранулированным градиентом, официальная разметка половины корта (трехочковая дуга, штрафная, линия «топ ключа», полукруг под щитом, боковые/базовая линии). Белая разметка с легким свечением.
- Кольцо/щит: щит стеклянный с неоновой каймой, обод теплый оранжевый, сетка полупрозрачная.
- Трибуны: два яруса по бокам в красно‑голубых секциях с неоновыми лентами; бегущие огни. На бортах — повторяющиеся пиктограммы: круг/треугольник/квадрат в чередовании.
- HUD/UI: стекломорфизм, мягкие тени. Счет слева/справа (Вы vs Бот), шот‑клок по центру сверху, индикатор выносливости над игроком, индикатор силы броска у курсора/игрока. Подсказки клавиш внизу.

Аудио
- Музыка только в меню (петля, громкость 30%).
- SFX: скрип паркета, свисток, отскок мяча, попадание по щиту/обод, «swish», толчок/фол, сирена шот‑клок.
- Разблокировка аудио при первом клике. Регулятор громкости в настройках.

UI/Сцены
- Boot → Preload (прогресс) → Menu (Играть, Настройки, Таблица рекордов, Управление) → Game → Pause → GameOver.
- Настройки: сложность (Casual/Standard/Competitive — по умолчанию Standard), длина шот‑клока (12/24/∞), тип очков (1/2 или 2/3), громкость.
- Таблица рекордов: локальная. Метрики: лучшее время до 11, лучшая разница счетов, точность бросков.

Техника
- Изометрия: экспортируй функции worldToScreen/screenToWorld; isoX/isoY настраиваемые. Поддержи масштаб полотна под DPR и ресайз.
- Коллизии: AABB/круги. Пространственная сетка не обязательна (сцена малонаселенная).
- Игровые состояния: possession, check_ball, live_ball, foul_free_throw, score_reset.
- Штрафной: бросок из точки штрафной, шот‑клок перезапускается после результата.
- Таймеры: шот‑клок 24; предупреждение звуком на 5 сек.
- Камера: фиксированная изометрия на полкорта, небольшой параллакс трибун.

Файлы и модули (ES‑модули)
- index.html: Canvas #game, overlay UI, подключение styles/*.css и src/main.js, мета для ПК.
- styles/: base.css, ui.css, animations.css. В ui.css определи переменные, стекломорфные панели, неоновые границы.
- src/main.js: создание Game, загрузка сцен.
- src/core/: Game, Loop, SceneManager, Input, Audio, RNG, Math, Projection (изометрия).
- src/scenes/: BootScene, PreloadScene, MenuScene, GameScene, PauseScene, GameOverScene.
- src/game/: CourtRenderer (разметка, трибуны, борта с пиктограммами), Ball, Player, AIController, Physics, Rules, HUD.
- src/assets/: заглушки звуков/music. В коде предусмотри пути assets/sfx/*.wav, assets/music/*.mp3, images/ не обязательны.
- tests/: юнит‑тесты геометрии броска и пересечений (минимум).

Интерфейсы ключевых объектов
- Player:
  - props: pos{x,y}, z, vel{…}, stamina, hasBall, team, state.
  - methods: update(dt, ctx), render(ctx, alpha), tryShoot(power, aim), startDribble(), stepBack(), trySteal(target), applyStamina(cost), resetForCheckBall().
- Ball:
  - props: pos{x,y}, z, vel{…}, holderId|null, state: free/held/inFlight.
  - methods: attachTo(player), release(velocity3D), update(dt), collideRim(), collideBackboard(), isScore().
- AIController:
  - methods: update(dt, world), setDifficulty('Standard'), decideAction(), aimAtHoop(distance, contestFactor).
- Rules:
  - score model (street 1/2 by default), shotClock, possession, checkBall/clear detection, foul handling.

UI/HUD задачи
- Счет: «Вы 00 — 00 Бот».
- Шот‑клок: крупные цифры, мигание <5 сек.
- Индикатор выносливости: полоска над игроком, цвет меняется зеленый→желтый→красный.
- Индикатор силы броска: круг/дуга около игрока; подсказка «Отпустите ЛКМ для броска».
- Подсказки управления на старте раунда.

Геймдизайн параметры по умолчанию (config.js)
- Длина корта (полкорта): ширина 15 м, длина 14 м (в условных ед.). Триочковая дуга радиус 6.75 м; штрафная 4.6 м.
- Скорость игрока: base 3.6 м/с; спринт ×1.5; ускорение/трение реалистичные.
- Стамина: 100 макс; спринт −15/с; реген +10/с в покое; влияние на точность броска и скорость.
- Бросок: оптимальная сила — функция distance→initialSpeed; допуск ±8%. Магнитное окно на обод ε = 0.08 м в аркадном режиме.
- Рим/щит: r_rim = 0.23 м; board: ширина 1.8 м, высота 1.05 м; координаты согласно стандарту.
- Кулдаун перехвата: 0.7 сек; шанс фола при контакте на броске 35% (тонкая настройка в config).

Аудио‑события
- start_game, whistle, shot_release, rim_hit, backboard, swish, steal, foul, shotclock_warn, score.

Что сгенерировать в первой версии
1) Рабочий прототип GameScene с изометрией: корт, кольцо/щит, игрок, бот, мяч, разметка, трибуны/борта с пиктограммами, параллакс.
2) Полный цикл раунда: check ball → live ball → очко/фол/аут → ресет владения. Очки по модели 1/2, счет до 11, победа.
3) Управление K2 и все индикаторы HUD (счет, шот‑клок, выносливость, сила броска).
4) AI уровня Standard с описанными состояниями.
5) Аудио: разблокировка, базовые SFX, музыка в меню.
6) Меню, пауза, экран победы/поражения. Настройки (длина шот‑клока, сложность, очки 1/2 vs 2/3, громкость).
7) Конфиги/константы и JSDoc //@ts-check. Без ошибок в консоли.

Критерии приемки
- Стабильные 60 FPS на ПК среднего уровня при базовом разрешении Canvas; корректная изометрическая сортировка.
- Бросок ощущается «честно»: корректная зависимость силы от дистанции, базовые отскоки от щита/обода, аккаунтинг «магнитного окна».
- AI ведет себя естественно: защищается, атакует, бросает открытые, форсирует решения под конец шот‑клока.
- Все требуемые элементы HUD и аудио работают; матч корректно завершается при 11 очках.
- Дизайн соответствует палитре и стилю (желтый корт, красно‑голубые трибуны, неоновые борта с пиктограммами).

Примечания
- ПКМ перехват работает только в защите; в атаке — step‑back/лэйап.
- Обязательно предусмотреть «очистку» мяча за дугой при смене владения.
- Поддержка только ПК; тач‑контролы не нужны.

Сгенерируй проект, затем опиши, как поменять параметры в config (скорости, радиусы, окно «магнита», шот‑клок), и выведи краткие инструкции по управлению на русском в меню.